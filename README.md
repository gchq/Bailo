[![Contributors][contributors-shield]][contributors-url] [![Forks][forks-shield]][forks-url]
[![Stargazers][stars-shield]][stars-url] [![Issues][issues-shield]][issues-url]
[![License][license-shield]][license-url]

<!-- prettier-ignore-start -->
> [!NOTE]
> `main` branch now tracks `v2` by default. To access the legacy Bailo, see the `v1` branch. `v1` has been removed
> from this project - see [migrations](https://gchq.github.io/Bailo/docs/administration/migrations/bailo-2.0) for more
> information.
<!-- prettier-ignore-end -->

<!-- PROJECT LOGO -->
<br />
<div align="center">
  <a href="https://github.com/gchq/bailo">
    <h1>
      <!-- TODO: Fix #gh-dark-mode-only -->
      <img src="frontend/public/logo-vertical-dark-transparent.png" alt="Logo" width="170">
    </h1>
  </a>

  <p align="center">
    Making it easy to compliantly manage the machine learning lifecycle
    <br />
    <a href="https://gchq.github.io/Bailo/docs"><strong>Explore the docs »</strong></a>
    <br />
    <br />
    <a href="https://github.com/gchq/bailo/issues">Report a Bug</a>
    ·
    <a href="https://github.com/gchq/bailo/issues">Request a Feature</a>
  </p>
</div>

<!-- TABLE OF CONTENTS -->
<details>
  <summary>Table of Contents</summary>
  <ol>
    <li>
      <a href="#about-the-project">About The Project</a>
      <ul>
        <li><a href="#built-with">Built With</a></li>
      </ul>
    </li>
    <li>
      <a href="#getting-started">Getting Started</a>
      <ul>
        <li><a href="#requirements">Requirements</a></li>
        <li><a href="#installation">Installation</a></li>
        <li><a href="#service-ports">Service Ports</a></li>
        <li><a href="#logical-project-flow-overview">Logical Project Flow (Overview)</a></li>
        <li><a href="#known-issues">Known Issues</a></li>
      </ul>
    </li>
    <li><a href="#usage">Usage</a></li>
    <li><a href="#contributing">Contributing</a></li>
    <li><a href="#breaking-changes">Breaking Changes</a></li>
    <li><a href="#license">License</a></li>
    <li><a href="#acknowledgments">Acknowledgments</a></li>
  </ol>
</details>

<br />

<!-- ABOUT THE PROJECT -->

## About The Project

[![Product Screen Shot][product-screenshot]](https://github.com/gchq/bailo)

Bailo helps you manage the lifecycle of machine learning to support scalability, impact, collaboration, compliance and
sharing.

### Built With

- [Next.js](https://nextjs.org/)
- [Node.js](https://nodejs.org/)
- [MongoDB](https://www.mongodb.com/)
- [Seldon](https://www.seldon.io/)

<br />

<!-- GETTING STARTED -->

## Getting Started

### Requirements

- Node v22
- Docker / Docker Compose

<br />

### Installation

To run in standalone mode, not development mode (http://localhost:8080). Not for production use:

```bash
docker build -t "bailo:standalone" -f ./Dockerfile.standalone .
docker run --name bailo -p 8080:8080 -d bailo:standalone
```

To run in development mode (modified files on your host machine will be reloaded into the running application):

```bash
git clone https://github.com/gchq/Bailo.git && cd Bailo
npm install
npm run certs

# This builds all the Bailo images, rerun it when you update dependencies.
docker compose build --parallel

# Then run the development instance of Bailo.
docker compose up -d
```

On first run, it may take a while (up to 30 seconds) to start up. It needs to build several hundred TypeScript modules.
These are cached however, so future starts only require a few seconds. You should access the site via
[localhost:8080](http://localhost:8080).

The registry requires a JWKS file for the token authentication with the backend application. For development, a JWKS
file is generated by running `npm run certs`. For production, the script `generateJWKS.ts` can be used to generate a
JWKS file for the public key referenced in the backend application configuration.

<br />

### Service Ports

| Service    | Host  | Notes                 |
| ---------- | ----- | --------------------- |
| Next UI    | 3000  | Stored in `frontend`  |
| NodeJS App | 3001  | Stored in `backend`   |
| Mongo      | 27017 | No credentials        |
| Registry   | 5000  | HTTPS only, no UI     |
| Minio UI   | 9001  | minioadmin:minioadmin |
| Minio      | 9000  | minioadmin:minioadmin |
| MailCrab   | 1080  | Fake email server     |

\*\* Note: these credentials are intentionally basic/default, but in your own instances we recommend changing them to
something more secure.

We expect the administrator to provide their own forms of authentication. By default all users authenticate using as
'user'.

You can test out your new deployment using the example models which can be found in `frontend/cypress/fixtures`
[`minimal_binary.zip`](frontend/cypress/fixtures/minimal_binary.zip) and
[`minimal_code.zip`](frontend/cypress/fixtures/minimal_code.zip). There are also example forms in the `scripts` folder
[`minimal_model_schema.json`](backend/src/scripts/example_schemas/minimal_model_schema.json),
[`minimal_data_card_schema.json`](backend/src/scripts/example_schemas/minimal_data_card_schema.json) and
[`minimal_access_request_schema.json`](backend/src/scripts/example_schemas/minimal_access_request_schema.json).

<br />

### Logical Project Flow (Overview)

![bailo diagram](frontend/public/mm-diagram.png)

1. A user accesses a URL. We use [NextJS routing](https://nextjs.org/docs/routing/introduction) to point it to a file in
   `frontend/pages`. `[xxx].tsx` files accept any route, `xxx.tsx` files allow only that specific route.
2. Data is loaded using [SWR](https://swr.vercel.app/). Data loaders are stored in `frontend/actions`. Each one exposes
   variables to specify if it is loading, errored, data, etc.
3. Requests to the backend get routed through [express](https://expressjs.com/) within `backend/src/routes.ts`. Each
   route is an array with all items being middleware except the last, which is the handler (`[...middleware, handler]`).
4. Routes interact with the database via `mongoose`, which stores models in `backend/src/models`.

<br />

### Known Issues

- _Issue: Sometimes Docker struggles when you add a new dependency._ <br /> Fix: Run `docker compose down --rmi all`
  followed by `docker compose up --build`.

- _Issue: Sometimes SWR fails to install its own binary and the project will refuse to start up (development only)_
  <br /> Fix: Run `npm uninstall next && npm install next`. Some users report still having issues. If so, run:
  `rm -rf node_modules && rm -rf package-lock.json && npm cache clean -f && npm i`.

- _Issue: Unable to authenticate to the Docker registry / compile binaries._ <br /> Fix: Make sure that your
  authentication proxy is setup to allow the 'Authorisation' header. Make sure that your application is able to access
  the Docker registry internally as it will not provide user authentication.

<br />

## Usage

See [our user documentation](https://gchq.github.io/Bailo/docs)

<br />

<!-- CONTRIBUTING -->

## Contributing

If you are looking for an existing issue to help with, check out the
[help wanted tickets](https://github.com/gchq/bailo/issues?q=is%3Aopen+is%3Aissue+label%3A%22help+wanted%22) on GitHub.
If you see any that you are interested in working on, comment on it to let everyone know you are working on it. If there
is no ticket for what you want to contribute, start a [new issue](https://github.com/gchq/bailo/issues) to discuss
whether it follows the aims of this project. We ask this even for bugs, as there may be multiple solutions to be
considered.

Prior to us accepting any work, you must sign the [GCHQ CLA Agreement](https://cla-assistant.io/gchq/Bailo). We follow a
branching strategy for handling contributions:

1. Fork the Project
2. Create your Feature Branch (`git checkout -b feature/new_thing`)
3. Commit your Changes (`git commit -m 'Add a new thing'`)
4. Push to the Branch (`git push origin feature/new_thing`)
5. Open a Pull Request

<br />

<!-- BREAKING CHANGES -->

## Breaking Changes

**28-04-2022**: Changed 'schema' model to be stored as a string instead of an object. Delete & recreate your schemas.

<br />

<!-- LICENSE -->

## License

Bailo is released under the Apache 2.0 Licence and is covered by Crown Copyright. See `LICENSE.txt` for more
information.

<br />

<!-- ACKNOWLEDGMENTS -->

## Acknowledgments

- [Img Shields](https://shields.io)
- [Othneils's README Template](https://github.com/othneildrew/Best-README-Template)
- [Mattermost's Code Contribution Guidelines](https://github.com/mattermost/mattermost-server/blob/master/CONTRIBUTING.md)

<!-- MARKDOWN LINKS & IMAGES -->
<!-- https://www.markdownguide.org/basic-syntax/#reference-style-links -->

[contributors-shield]: https://img.shields.io/github/contributors/gchq/bailo.svg?style=for-the-badge
[contributors-url]: https://github.com/gchq/bailo/graphs/contributors
[forks-shield]: https://img.shields.io/github/forks/gchq/bailo.svg?style=for-the-badge
[forks-url]: https://github.com/gchq/bailo/network/members
[stars-shield]: https://img.shields.io/github/stars/gchq/bailo.svg?style=for-the-badge
[stars-url]: https://github.com/gchq/bailo/stargazers
[issues-shield]: https://img.shields.io/github/issues/gchq/bailo.svg?style=for-the-badge
[issues-url]: https://github.com/gchq/bailo/issues
[license-shield]: https://img.shields.io/github/license/gchq/bailo.svg?style=for-the-badge
[license-url]: https://github.com/gchq/bailo/blob/main/public/LICENSE.txt
[product-screenshot]: frontend/public/images/bailo-marketplace.png
